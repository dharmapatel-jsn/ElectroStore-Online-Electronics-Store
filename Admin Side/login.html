<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Login - ElectroStore</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: #ffffff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .login-box {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 40px;
            width: 100%;
            max-width: 400px;
            border: 1px solid #e9ecef;
        }
        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }
        .login-header h2 {
            color: #1e3a8a;
            font-weight: 700;
            margin-bottom: 8px;
        }
        .login-header p {
            color: #6c757d;
            margin: 0;
        }
        .form-control {
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }
        .form-control:focus {
            border-color: #1e3a8a;
            box-shadow: 0 0 0 0.2rem rgba(30, 58, 138, 0.1);
        }
        .btn-login {
            background: #1e3a8a;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            width: 100%;
            transition: all 0.3s ease;
        }
        .btn-login:hover {
            background: #1e40af;
            color: white;
        }
        .error-message {
            color: #dc3545;
            font-size: 14px;
            margin-top: -15px;
            margin-bottom: 15px;
        }
        .demo-info {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            text-align: center;
        }
        .password-toggle {
            border: none !important;
            background: transparent !important;
            color: #6c757d;
            transition: color 0.3s ease;
        }
        .password-toggle:hover {
            color: #1e3a8a !important;
        }
        .form-check {
            margin-bottom: 1rem;
        }
        .form-check-input:checked {
            background-color: #1e3a8a;
            border-color: #1e3a8a;
        }
    </style>
</head>
<body>
    <div class="login-container">
        <div class="login-box">
            <div class="login-header">
                <i class="fas fa-bolt" style="font-size: 3rem; color: #ffc107; margin-bottom: 15px;"></i>
                <h2>ElectroStore Admin</h2>
                <p>Sign in to access your dashboard</p>
            </div>
            
            <form id="loginForm" onsubmit="handleLogin(event)">
                <div class="mb-3">
                    <label for="username" class="form-label fw-semibold">
                        <i class="fas fa-user me-2"></i>Username
                    </label>
                    <input type="text" 
                           class="form-control" 
                           id="username" 
                           name="username" 
                           placeholder="Enter your username" 
                           required>
                    <div class="error-message" id="usernameError"></div>
                </div>

                <div class="mb-3">
                    <label for="password" class="form-label fw-semibold">
                        <i class="fas fa-lock me-2"></i>Password
                    </label>
                    <div class="position-relative">
                        <input type="password" 
                               class="form-control" 
                               id="password" 
                               name="password" 
                               placeholder="Enter your password" 
                               required>
                        <button type="button" class="password-toggle position-absolute end-0 top-50 translate-middle-y me-2" 
                                onclick="togglePassword()" style="z-index: 10;">
                            <i class="fas fa-eye text-muted" id="toggleIcon"></i>
                        </button>
                    </div>
                    <div class="error-message" id="passwordError"></div>
                </div>

                <div class="mb-4">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="rememberMe">
                        <label class="form-check-label text-muted" for="rememberMe">
                            Remember me
                        </label>
                    </div>
                </div>

                <button type="submit" class="btn-login">
                    <i class="fas fa-sign-in-alt me-2"></i>Sign In
                </button>
            </form>

            <div class="demo-info">
                <small class="text-muted">
                    <i class="fas fa-info-circle me-2"></i>
                    <strong>Demo Credentials:</strong> admin / admin123
                </small>
            </div>
        </div>
    </div>

                    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Global variables for validation
        let failedAttempts = 0;
        const maxAttempts = 3;
        let isBlocked = false;
        let blockTime = null;
        
        // Initialize validation when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeValidation();
            checkLoginStatus();
            checkBlockStatus();
            addInputEventListeners();
        });

        // Enhanced validation initialization
        function initializeValidation() {
            const form = document.getElementById('loginForm');
            const usernameInput = document.getElementById('username');
            const passwordInput = document.getElementById('password');
            
            // Real-time validation on input
            usernameInput.addEventListener('input', validateUsernameRealTime);
            usernameInput.addEventListener('blur', validateUsername);
            passwordInput.addEventListener('input', validatePasswordRealTime);
            passwordInput.addEventListener('blur', validatePassword);
            
            // Prevent form submission if blocked
            form.addEventListener('submit', handleFormSubmit);
        }

        // Real-time username validation
        function validateUsernameRealTime() {
            const username = document.getElementById('username').value;
            const usernameError = document.getElementById('usernameError');
            const usernameInput = document.getElementById('username');
            
            // Clear previous styling
            usernameInput.classList.remove('is-valid', 'is-invalid');
            usernameError.textContent = '';
            
            if (username.length > 0) {
                if (username.length < 3) {
                    showFieldError('username', 'Username must be at least 3 characters long');
                    return false;
                } else if (!/^[a-zA-Z0-9_]+$/.test(username)) {
                    showFieldError('username', 'Username can only contain letters, numbers, and underscores');
                    return false;
                } else {
                    showFieldSuccess('username');
                    return true;
                }
            }
            return false;
        }

        // Real-time password validation
        function validatePasswordRealTime() {
            const password = document.getElementById('password').value;
            const passwordError = document.getElementById('passwordError');
            const passwordInput = document.getElementById('password');
            
            // Clear previous styling
            passwordInput.classList.remove('is-valid', 'is-invalid');
            passwordError.textContent = '';
            
            if (password.length > 0) {
                if (password.length < 6) {
                    showFieldError('password', 'Password must be at least 6 characters long');
                    return false;
                } else if (!/(?=.*[a-zA-Z])(?=.*\d)/.test(password)) {
                    showFieldError('password', 'Password must contain both letters and numbers');
                    return false;
                } else {
                    showFieldSuccess('password');
                    return true;
                }
            }
            return false;
        }

        // Validate username field
        function validateUsername() {
            const username = document.getElementById('username').value.trim();
            
            if (!username) {
                showFieldError('username', 'Username is required');
                return false;
            }
            
            if (username.length < 3) {
                showFieldError('username', 'Username must be at least 3 characters long');
                return false;
            }
            
            if (!/^[a-zA-Z0-9_]+$/.test(username)) {
                showFieldError('username', 'Username can only contain letters, numbers, and underscores');
                return false;
            }
            
            showFieldSuccess('username');
            return true;
        }

        // Validate password field
        function validatePassword() {
            const password = document.getElementById('password').value.trim();
            
            if (!password) {
                showFieldError('password', 'Password is required');
                return false;
            }
            
            if (password.length < 6) {
                showFieldError('password', 'Password must be at least 6 characters long');
                return false;
            }
            
            if (!/(?=.*[a-zA-Z])(?=.*\d)/.test(password)) {
                showFieldError('password', 'Password must contain both letters and numbers');
                return false;
            }
            
            showFieldSuccess('password');
            return true;
        }

        // Show field error
        function showFieldError(fieldName, message) {
            const field = document.getElementById(fieldName);
            const errorDiv = document.getElementById(fieldName + 'Error');
            
            field.classList.remove('is-valid');
            field.classList.add('is-invalid');
            field.style.borderColor = '#dc3545';
            errorDiv.textContent = message;
            errorDiv.style.color = '#dc3545';
        }

        // Show field success
        function showFieldSuccess(fieldName) {
            const field = document.getElementById(fieldName);
            const errorDiv = document.getElementById(fieldName + 'Error');
            
            field.classList.remove('is-invalid');
            field.classList.add('is-valid');
            field.style.borderColor = '#198754';
            errorDiv.textContent = '';
        }

        // Clear all errors
        function clearAllErrors() {
            ['username', 'password'].forEach(fieldName => {
                const field = document.getElementById(fieldName);
                const errorDiv = document.getElementById(fieldName + 'Error');
                
                field.classList.remove('is-valid', 'is-invalid');
                field.style.borderColor = '#e9ecef';
                errorDiv.textContent = '';
            });
        }

        // Handle form submission with enhanced validation
        function handleFormSubmit(event) {
            event.preventDefault();
            
            // Check if blocked
            if (isBlocked) {
                showGeneralError('Too many failed attempts. Please wait before trying again.');
                return;
            }
            
            // Clear previous errors
            clearAllErrors();
            
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            const submitBtn = event.target.querySelector('button[type="submit"]');
            
            // Comprehensive validation
            const isUsernameValid = validateUsername();
            const isPasswordValid = validatePassword();
            
            if (!isUsernameValid || !isPasswordValid) {
                shakeForm();
                return;
            }
            
            // Additional security checks
            if (detectSQLInjection(username) || detectSQLInjection(password)) {
                showGeneralError('Invalid characters detected. Please use valid input.');
                incrementFailedAttempts();
                return;
            }
            
            // Show loading state with enhanced animation
            showLoadingState(submitBtn);
            
            // Simulate authentication with realistic delay
            setTimeout(() => {
                authenticateUser(username, password, submitBtn);
            }, 1500);
        }

        // Enhanced authentication function
        function authenticateUser(username, password, submitBtn) {
            // Check credentials
            if (username === 'admin' && password === 'admin123') {
                // Reset failed attempts on successful login
                failedAttempts = 0;
                localStorage.removeItem('loginFailedAttempts');
                localStorage.removeItem('loginBlockTime');
                
                // Store enhanced admin session
                const adminData = {
                    username: 'admin',
                    name: 'Administrator',
                    role: 'Super Admin',
                    loginTime: new Date().toISOString(),
                    sessionId: generateSessionId(),
                    permissions: ['read', 'write', 'delete', 'admin']
                };
                
                localStorage.setItem('adminLoggedIn', 'true');
                localStorage.setItem('adminUser', JSON.stringify(adminData));
                localStorage.setItem('lastActivity', Date.now());
                
                // Success animation
                showSuccessState(submitBtn);
                
                // Redirect with success message
                setTimeout(() => {
                    window.location.href = 'dashboard.html';
                }, 1000);
                
            } else {
                // Handle failed login
                incrementFailedAttempts();
                showFailureState(submitBtn);
                
                // Show specific error based on field
                if (username !== 'admin') {
                    showFieldError('username', 'Invalid username');
                }
                if (password !== 'admin123') {
                    showFieldError('password', 'Invalid password');
                }
                
                shakeForm();
                
                // Reset button after delay
                setTimeout(() => {
                    resetSubmitButton(submitBtn);
                }, 2000);
            }
        }

        // Increment failed attempts and handle blocking
        function incrementFailedAttempts() {
            failedAttempts++;
            localStorage.setItem('loginFailedAttempts', failedAttempts);
            
            if (failedAttempts >= maxAttempts) {
                blockUser();
            } else {
                const remaining = maxAttempts - failedAttempts;
                showGeneralError(`Invalid credentials. ${remaining} attempt(s) remaining.`);
            }
        }

        // Block user temporarily
        function blockUser() {
            isBlocked = true;
            blockTime = Date.now() + (5 * 60 * 1000); // Block for 5 minutes
            localStorage.setItem('loginBlockTime', blockTime);
            
            showGeneralError('Too many failed attempts. Access blocked for 5 minutes.');
            disableForm();
            startBlockTimer();
        }

        // Check if user is currently blocked
        function checkBlockStatus() {
            const storedBlockTime = localStorage.getItem('loginBlockTime');
            const storedFailedAttempts = localStorage.getItem('loginFailedAttempts');
            
            if (storedFailedAttempts) {
                failedAttempts = parseInt(storedFailedAttempts);
            }
            
            if (storedBlockTime) {
                const blockEndTime = parseInt(storedBlockTime);
                const currentTime = Date.now();
                
                if (currentTime < blockEndTime) {
                    isBlocked = true;
                    blockTime = blockEndTime;
                    disableForm();
                    startBlockTimer();
                } else {
                    // Block time expired, reset
                    localStorage.removeItem('loginBlockTime');
                    localStorage.removeItem('loginFailedAttempts');
                    failedAttempts = 0;
                    isBlocked = false;
                }
            }
        }

        // Start countdown timer for blocked user
        function startBlockTimer() {
            const timerInterval = setInterval(() => {
                const currentTime = Date.now();
                const timeRemaining = blockTime - currentTime;
                
                if (timeRemaining <= 0) {
                    // Block expired
                    clearInterval(timerInterval);
                    isBlocked = false;
                    failedAttempts = 0;
                    localStorage.removeItem('loginBlockTime');
                    localStorage.removeItem('loginFailedAttempts');
                    enableForm();
                    clearGeneralError();
                } else {
                    const minutes = Math.floor(timeRemaining / 60000);
                    const seconds = Math.floor((timeRemaining % 60000) / 1000);
                    showGeneralError(`Access blocked. Try again in ${minutes}:${seconds.toString().padStart(2, '0')}`);
                }
            }, 1000);
        }

        // Disable form during block
        function disableForm() {
            document.getElementById('username').disabled = true;
            document.getElementById('password').disabled = true;
            document.querySelector('button[type="submit"]').disabled = true;
        }

        // Enable form after block
        function enableForm() {
            document.getElementById('username').disabled = false;
            document.getElementById('password').disabled = false;
            document.querySelector('button[type="submit"]').disabled = false;
        }

        // Detect potential SQL injection
        function detectSQLInjection(input) {
            const sqlPatterns = [
                /('|\\')|(;\s*((drop|delete|insert|update|create|alter|exec|execute)\s))/i,
                /(union|select|from|where|having|group\s+by|order\s+by)/i,
                /(script|javascript|vbscript|onload|onerror|onclick)/i
            ];
            
            return sqlPatterns.some(pattern => pattern.test(input));
        }

        // Generate session ID
        function generateSessionId() {
            return 'sess_' + Math.random().toString(36).substr(2, 9) + Date.now().toString(36);
        }

        // Show loading state
        function showLoadingState(button) {
            button.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Authenticating...';
            button.disabled = true;
            button.style.background = '#6c757d';
        }

        // Show success state
        function showSuccessState(button) {
            button.innerHTML = '<i class="fas fa-check me-2"></i>Login Successful!';
            button.style.background = '#198754';
            button.style.transform = 'scale(1.05)';
        }

        // Show failure state
        function showFailureState(button) {
            button.innerHTML = '<i class="fas fa-times me-2"></i>Login Failed';
            button.style.background = '#dc3545';
        }

        // Reset submit button
        function resetSubmitButton(button) {
            button.innerHTML = '<i class="fas fa-sign-in-alt me-2"></i>Sign In';
            button.style.background = '#1e3a8a';
            button.style.transform = 'scale(1)';
            button.disabled = false;
        }

        // Show general error message
        function showGeneralError(message) {
            const errorDiv = document.getElementById('usernameError');
            errorDiv.textContent = message;
            errorDiv.style.color = '#dc3545';
            errorDiv.style.fontWeight = 'bold';
        }

        // Clear general error
        function clearGeneralError() {
            const errorDiv = document.getElementById('usernameError');
            errorDiv.textContent = '';
        }

        // Shake form animation
        function shakeForm() {
            const loginBox = document.querySelector('.login-box');
            loginBox.style.animation = 'shake 0.6s ease-in-out';
            setTimeout(() => {
                loginBox.style.animation = '';
            }, 600);
        }

        // Add input event listeners for better UX
        function addInputEventListeners() {
            const inputs = document.querySelectorAll('input[type="text"], input[type="password"]');
            
            inputs.forEach(input => {
                input.addEventListener('focus', function() {
                    this.style.borderColor = '#1e3a8a';
                    this.style.boxShadow = '0 0 0 0.2rem rgba(30, 58, 138, 0.25)';
                });
                
                input.addEventListener('blur', function() {
                    if (!this.classList.contains('is-invalid') && !this.classList.contains('is-valid')) {
                        this.style.borderColor = '#e9ecef';
                        this.style.boxShadow = 'none';
                    }
                });
                
                // Clear errors when user starts typing
                input.addEventListener('input', function() {
                    if (this.classList.contains('is-invalid')) {
                        clearGeneralError();
                    }
                });
            });
        }

        // Check if already logged in
        function checkLoginStatus() {
            if (localStorage.getItem('adminLoggedIn') === 'true') {
                const lastActivity = localStorage.getItem('lastActivity');
                const currentTime = Date.now();
                const sessionTimeout = 24 * 60 * 60 * 1000; // 24 hours
                
                if (lastActivity && (currentTime - parseInt(lastActivity)) < sessionTimeout) {
                    window.location.href = 'dashboard.html';
                } else {
                    // Session expired
                    localStorage.removeItem('adminLoggedIn');
                    localStorage.removeItem('adminUser');
                    localStorage.removeItem('lastActivity');
                }
            }
        }

        // Toggle password visibility
        function togglePassword() {
            const passwordField = document.getElementById('password');
            const toggleIcon = document.getElementById('toggleIcon');
            
            if (passwordField.type === 'password') {
                passwordField.type = 'text';
                toggleIcon.className = 'fas fa-eye-slash text-primary';
            } else {
                passwordField.type = 'password';
                toggleIcon.className = 'fas fa-eye text-muted';
            }
        }

        // Enhanced login function for form handler
        function handleLogin(event) {
            handleFormSubmit(event);
        }
        
        // Add CSS animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                10%, 30%, 50%, 70%, 90% { transform: translateX(-8px); }
                20%, 40%, 60%, 80% { transform: translateX(8px); }
            }
            
            .is-valid {
                border-color: #198754 !important;
                box-shadow: 0 0 0 0.2rem rgba(25, 135, 84, 0.25) !important;
            }
            
            .is-invalid {
                border-color: #dc3545 !important;
                box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25) !important;
            }
            
            .btn-login:disabled {
                opacity: 0.7;
                cursor: not-allowed;
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>